<div class="products-page">

  <!-- ðŸ” FILTER (LIJEVA KOLONA) -->
  <section class="filter-section">
    <h2>Filter</h2>

    <form [formGroup]="filterForm" (ngSubmit)="onSubmit()">

      <input
        type="text"
        formControlName="searchQuery"
        placeholder="Search products..."
        class="search-input"
      />

      <select formControlName="categoryId">
        <option [value]="null">All categories</option>
        <option *ngFor="let cat of categories" [value]="cat.id">
          {{ cat.name }}
        </option>
      </select>

      <div class="price-range">
        <label>From:</label>
        <input type="number" formControlName="minPrice" />

        <label>To:</label>
        <input type="number" formControlName="maxPrice" />
      </div>

      <select formControlName="sortBy">
        <option value="datedesc">Latest</option>
        <option value="dateasc">Oldest</option>
        <option value="priceasc">Price â€“ Low to High</option>
        <option value="pricedesc">Price â€“ High to Low</option>
        <option value="nameasc">Name Aâ€“Z</option>
        <option value="namedesc">Name Zâ€“A</option>
      </select>

      <button type="submit">Apply filter</button>
    </form>
  </section>

  <!-- ðŸ§© PRODUCTS (DESNA KOLONA) -->
  <section class="product-list">

    <!-- ðŸŸ¡ PROMO KOD (IZNAD PRODUKATA) -->
    <div class="promo-info" *ngIf="promoCode">
      Promo kod: <strong>{{ promoCode }}</strong>
      <div style="font-size: 13px; font-weight: 400; margin-top: 4px;">
        Iskoristite promo kod prilikom kupovine i ostvarite dodatni popust.
      </div>
    </div>

    <h2>Products</h2>

    <!-- GRID PRODUKATA -->
    <div class="product-grid">

      <div *ngFor="let product of products" class="product-card">

        <!-- ðŸ”» BADGE POPUST -->
        <span
          *ngIf="product.badgeDiscountPercentage"
          class="discount-badge"
        >
          -{{ product.badgeDiscountPercentage }}%
        </span>

        <!-- â¤ï¸ FAVORITE -->
        <button
          *ngIf="authService.isLoggedIn()"
          class="favorite-btn"
          (click)="toggleFavorite(product)"
        >
          <i
            class="fa-heart"
            [class.fa-solid]="product.isFavorite"
            [class.fa-regular]="!product.isFavorite"
          ></i>
        </button>

        <!-- ðŸ–¼ï¸ SLIKA -->
        <div class="product-image">
          <img
            [src]="product.imageUrl"
            [alt]="product.name"
          />
        </div>

        <!-- â„¹ï¸ INFO -->
        <div class="product-info">
          <span class="category-badge">
            {{ product.categoryName }}
          </span>

          <h3>{{ product.name }}</h3>

          <p class="brand">
            <strong>Brand:</strong> {{ product.brend }}
          </p>

          <p class="price">

            <!-- STARA CIJENA -->
            <span
              *ngIf="
                product.priceAfterGlobalDiscount != null &&
                product.priceAfterGlobalDiscount < product.price
              "
              class="old-price"
            >
              {{ product.price }} KM
            </span>

            <!-- NOVA CIJENA -->
            <span class="new-price">
              {{
                product.priceAfterGlobalDiscount != null &&
                product.priceAfterGlobalDiscount < product.price
                  ? product.priceAfterGlobalDiscount
                  : product.price
              }} KM
            </span>

          </p>
        </div>

        <!-- ðŸ›’ ACTIONS -->
        <div class="product-actions" *ngIf="!isAdmin">
          <button
            mat-raised-button
            color="primary"
            (click)="addToCart(product.id)"
          >
            Add to cart
          </button>
        </div>

      </div>
    </div>

  </section>

</div>
