<div class="product-management-container">
  <h2>Managing products</h2>

  <div class="product-form">
    <h3>{{ isEditing ? 'Edit product' : 'Add new product' }}</h3>

    <form [formGroup]="productForm" (ngSubmit)="isEditing ? updateProduct() : addProduct()">

      <div class="form-row">
        <div class="form-group"><label>Product name <span class="required-asterisk">*</span></label>
          <input type="text" formControlName="name" placeholder="Enter product name" /></div>
        <div class="form-group"><label>SKU <span class="required-asterisk">*</span></label>
          <input type="text" formControlName="sku" placeholder="Enter SKU" /></div>
      </div>

      <div class="form-row">
        <div class="form-group"><label>Price (KM)<span class="required-asterisk">*</span></label>
          <input type="number" formControlName="price" placeholder="Enter price" /></div>
        <div class="form-group"><label>Stock quantity <span class="required-asterisk">*</span></label>
          <input type="number" formControlName="stockQuantity" placeholder="Enter  quantity" /></div>
      </div>

      <div class="form-group full-width">
        <label>Description</label>
        <textarea formControlName="description" placeholder="Enter product description"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group"><label>ID of category<span class="required-asterisk">*</span></label>
          <input type="number" formControlName="categoryId" placeholder="Enter  ID of category" /></div>
        <div class="form-group"><label>Brend<span class="required-asterisk">*</span></label>
          <input type="text" formControlName="brend" placeholder="Enter brend" /></div>
      </div>
      
      <div class="form-group image-input-group full-width">
        <label for="imageUrl">Image URL</label>
        <div class="input-with-button">
            <input id="imageUrl" type="text" formControlName="imageUrl" placeholder="Choose an image" />
            <button type="button" (click)="openImageModal()" class="btn btn-secondary btn-sm">
              Choose an image
            </button>
        </div>
        <div *ngIf="productForm.get('imageUrl')?.invalid && productForm.get('imageUrl')?.touched" class="error-message">
          Image URL is required.
        </div>
      </div>

      <div *ngIf="productForm.get('imageUrl')?.value" class="selected-image-preview full-width">
        <img
          [src]="productForm.get('imageUrl')?.value"
          alt="Chosen image"
          class="preview-img"
        />
      </div>

      <div class="form-row full-width controls-row">
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" formControlName="active" />
              Active
            </label>
          </div>

          <div class="button-group">
            <button type="submit" [disabled]="productForm.invalid" class="btn btn-primary">
              {{ isEditing ? 'Save changes' : 'Add  product' }}
            </button>
            <button type="button" (click)="cancelEdit()" *ngIf="isEditing" class="btn btn-warning">
              Cancel
            </button>
          </div>
      </div>

    </form>
  </div>
  
  <hr>

  <div class="product-list" *ngIf="products.length > 0">
    </div>
</div>


<div *ngIf="showImageModal" class="image-picker-modal-overlay">
  <div class="image-picker-modal-content">
    <h4>Choose image from folder</h4>

    <div class="image-grid">
      <div
        *ngFor="let imageURL of availableImages"
        class="image-item"
        (click)="selectImage(imageURL)"
      >
        <img [src]="imageURL" alt="Available  iamge" class="image-thumbnail" />
      </div>
    </div>

    <div *ngIf="availableImages.length === 0" class="no-images-message">
      Nema dostupnih slika u folderu 'wwwroot/images/products'.
    </div>

    <button type="button" (click)="closeImageModal()" class="btn btn-secondary mt-3">
      Close
    </button>
  </div>
</div>

<div class="product-list" *ngIf="products.length > 0">
    <h3>Existing products</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>SKU</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Brend</th>
          <th>Active</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of products">
          <td>{{ p.id }}</td>
          <td>{{ p.name }}</td>
          <td>{{ p.sku }}</td>
          <td>{{ p.price | currency:'BAM' }}</td>
          <td>{{ p.stockQuantity }}</td>
          <td>{{ p.brend }}</td>
          <td>{{ p.active ? 'Yes' : 'No' }}</td>
          <td class="actions">
            <button class="btn btn-small btn-edit" (click)="editProduct(p)">Edit</button>
            <button class="btn btn-small btn-delete" (click)="deleteProduct(p.id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

